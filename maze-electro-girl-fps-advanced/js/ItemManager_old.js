/**
 * ItemManager: ê³ ê¸‰ ì•„ì´í…œ ê´€ë¦¬ ì‹œìŠ¤í…œ
 * 
 * í•µì‹¬ ê¸°ëŠ¥:
 * - ì½”ì¸ ë° ì „ê¸° íë¸Œ ìƒì„± ë° ê´€ë¦¬
 * - ë™ì  ì•„ì´í…œ ìŠ¤í° ì‹œìŠ¤í…œ
 * - ì•„ì´í…œ ì• ë‹ˆë©”ì´ì…˜ ë° ì´í™íŠ¸
 * - ìˆ˜ì§‘ ì‹œ ì‹œê°ì /ì²­ê°ì  í”¼ë“œë°±
 * - ì•„ì´í…œë³„ íŠ¹ìˆ˜ íš¨ê³¼
 */
class ItemManager {
    constructor(scene, gameManager) {
        this.scene = scene;
        this.gameManager = gameManager;
        
        // ì•„ì´í…œ ë°°ì—´
        this.coins = [];
        this.powerCubes = [];
        this.specialItems = [];\n        \n        // ì•„ì´í…œ ì„¤ì •\n        this.itemTypes = {\n            COIN: {\n                value: 10,\n                model: null,\n                color: 0xFFD700,\n                size: 0.2,\n                rotationSpeed: 2,\n                bobSpeed: 3,\n                bobHeight: 0.1,\n                collectSound: 'coin_collect',\n                effectColor: 0xFFD700\n            },\n            POWER_CUBE: {\n                value: 20,\n                model: null,\n                color: 0x00FFFF,\n                size: 0.3,\n                rotationSpeed: 1,\n                bobSpeed: 2,\n                bobHeight: 0.15,\n                collectSound: 'power_collect',\n                effectColor: 0x00FFFF\n            },\n            HEALTH_PACK: {\n                value: 25,\n                model: null,\n                color: 0xFF6B6B,\n                size: 0.25,\n                rotationSpeed: 1.5,\n                bobSpeed: 2.5,\n                bobHeight: 0.12,\n                collectSound: 'health_collect',\n                effectColor: 0xFF6B6B\n            },\n            SPEED_BOOST: {\n                value: 0,\n                model: null,\n                color: 0x00FF00,\n                size: 0.22,\n                rotationSpeed: 3,\n                bobSpeed: 4,\n                bobHeight: 0.08,\n                collectSound: 'speed_boost',\n                effectColor: 0x00FF00,\n                duration: 10 // 10ì´ˆê°„ ì§€ì†\n            },\n            SHIELD: {\n                value: 0,\n                model: null,\n                color: 0x4169E1,\n                size: 0.28,\n                rotationSpeed: 0.8,\n                bobSpeed: 1.8,\n                bobHeight: 0.18,\n                collectSound: 'shield_collect',\n                effectColor: 0x4169E1,\n                duration: 15 // 15ì´ˆê°„ ì§€ì†\n            }\n        };\n        \n        // ìŠ¤í° ì„¤ì •\n        this.spawnSettings = {\n            coinDensity: 0.8, // ë¯¸ë¡œ ë‹¹ ì½”ì¸ ë°€ë„\n            powerCubeDensity: 0.3,\n            specialItemChance: 0.1, // íŠ¹ìˆ˜ ì•„ì´í…œ ìƒì„± í™•ë¥ \n            respawnTime: 30, // 30ì´ˆ í›„ ì¬ìƒì„±\n            maxItems: {\n                coins: 50,\n                powerCubes: 15,\n                specialItems: 8\n            }\n        };\n        \n        // ë™ì  ìŠ¤í° ì‹œìŠ¤í…œ\n        this.dynamicSpawn = {\n            enabled: true,\n            coinSpawnTimer: 0,\n            cubeSpawnTimer: 0,\n            specialSpawnTimer: 0,\n            coinSpawnInterval: 10, // 10ì´ˆë§ˆë‹¤ ì½”ì¸ ìŠ¤í°\n            cubeSpawnInterval: 25, // 25ì´ˆë§ˆë‹¤ íë¸Œ ìŠ¤í°\n            specialSpawnInterval: 60 // 60ì´ˆë§ˆë‹¤ íŠ¹ìˆ˜ ì•„ì´í…œ\n        };\n        \n        // ì´í™íŠ¸ íŒŒí‹°í´ ì‹œìŠ¤í…œ\n        this.particleSystem = {\n            particles: [],\n            maxParticles: 100\n        };\n        \n        this.init();\n    }\n    \n    init() {\n        this.createItemModels();\n        this.setupInitialItems();\n    }\n    \n    /**\n     * ì•„ì´í…œ ëª¨ë¸ ìƒì„±\n     */\n    createItemModels() {\n        // ì½”ì¸ ëª¨ë¸\n        const coinGeometry = new THREE.CylinderGeometry(0.2, 0.2, 0.05, 12);\n        const coinMaterial = new THREE.MeshPhongMaterial({ \n            color: this.itemTypes.COIN.color,\n            emissive: this.itemTypes.COIN.color * 0.2,\n            shininess: 100\n        });\n        this.itemTypes.COIN.geometry = coinGeometry;\n        this.itemTypes.COIN.material = coinMaterial;\n        \n        // ì „ê¸° íë¸Œ ëª¨ë¸\n        const cubeGeometry = new THREE.BoxGeometry(0.3, 0.3, 0.3);\n        const cubeMaterial = new THREE.MeshPhongMaterial({ \n            color: this.itemTypes.POWER_CUBE.color,\n            emissive: this.itemTypes.POWER_CUBE.color * 0.3,\n            transparent: true,\n            opacity: 0.9\n        });\n        this.itemTypes.POWER_CUBE.geometry = cubeGeometry;\n        this.itemTypes.POWER_CUBE.material = cubeMaterial;\n        \n        // ì²´ë ¥íŒ© ëª¨ë¸\n        const healthGeometry = new THREE.SphereGeometry(0.15, 8, 6);\n        const healthMaterial = new THREE.MeshPhongMaterial({ \n            color: this.itemTypes.HEALTH_PACK.color,\n            emissive: this.itemTypes.HEALTH_PACK.color * 0.2\n        });\n        this.itemTypes.HEALTH_PACK.geometry = healthGeometry;\n        this.itemTypes.HEALTH_PACK.material = healthMaterial;\n        \n        // ìŠ¤í”¼ë“œ ë¶€ìŠ¤íŠ¸ ëª¨ë¸\n        const speedGeometry = new THREE.ConeGeometry(0.15, 0.3, 6);\n        const speedMaterial = new THREE.MeshPhongMaterial({ \n            color: this.itemTypes.SPEED_BOOST.color,\n            emissive: this.itemTypes.SPEED_BOOST.color * 0.3\n        });\n        this.itemTypes.SPEED_BOOST.geometry = speedGeometry;\n        this.itemTypes.SPEED_BOOST.material = speedMaterial;\n        \n        // ì‹¤ë“œ ëª¨ë¸\n        const shieldGeometry = new THREE.OctahedronGeometry(0.2, 0);\n        const shieldMaterial = new THREE.MeshPhongMaterial({ \n            color: this.itemTypes.SHIELD.color,\n            emissive: this.itemTypes.SHIELD.color * 0.2,\n            transparent: true,\n            opacity: 0.8\n        });\n        this.itemTypes.SHIELD.geometry = shieldGeometry;\n        this.itemTypes.SHIELD.material = shieldMaterial;\n    }\n    \n    /**\n     * ì´ˆê¸° ì•„ì´í…œ ë°°ì¹˜\n     */\n    setupInitialItems() {\n        // ë¯¸ë¡œ ë ˆì´ì•„ì›ƒì— ë”°ë¼ ì•„ì´í…œ ë°°ì¹˜ (ì˜ˆì‹œ ìœ„ì¹˜)\n        const itemPositions = {\n            coins: [\n                new THREE.Vector3(2, 0.5, 2),\n                new THREE.Vector3(5, 0.5, 3),\n                new THREE.Vector3(8, 0.5, 6),\n                new THREE.Vector3(11, 0.5, 4),\n                new THREE.Vector3(6, 0.5, 9),\n                new THREE.Vector3(3, 0.5, 12),\n                new THREE.Vector3(13, 0.5, 8),\n                new THREE.Vector3(9, 0.5, 13),\n                new THREE.Vector3(4, 0.5, 7),\n                new THREE.Vector3(12, 0.5, 11)\n            ],\n            powerCubes: [\n                new THREE.Vector3(13, 0.5, 3),\n                new THREE.Vector3(3, 0.5, 10),\n                new THREE.Vector3(10, 0.5, 13),\n                new THREE.Vector3(7, 0.5, 5)\n            ],\n            specialItems: [\n                { position: new THREE.Vector3(1, 0.5, 1), type: 'HEALTH_PACK' },\n                { position: new THREE.Vector3(13, 0.5, 13), type: 'SHIELD' }\n            ]\n        };\n        \n        // ì½”ì¸ ìƒì„±\n        itemPositions.coins.forEach(pos => {\n            this.createItem('COIN', pos);\n        });\n        \n        // ì „ê¸° íë¸Œ ìƒì„±\n        itemPositions.powerCubes.forEach(pos => {\n            this.createItem('POWER_CUBE', pos);\n        });\n        \n        // íŠ¹ìˆ˜ ì•„ì´í…œ ìƒì„±\n        itemPositions.specialItems.forEach(item => {\n            this.createItem(item.type, item.position);\n        });\n    }\n    \n    /**\n     * ì•„ì´í…œ ìƒì„±\n     */\n    createItem(type, position) {\n        const itemType = this.itemTypes[type];\n        if (!itemType) return null;\n        \n        const item = new THREE.Mesh(itemType.geometry, itemType.material.clone());\n        item.position.copy(position);\n        item.castShadow = true;\n        \n        // ì•„ì´í…œ ë°ì´í„°\n        item.userData = {\n            type: type,\n            value: itemType.value,\n            collected: false,\n            animationTimer: Math.random() * Math.PI * 2, // ëœë¤ ì‹œì‘ ìœ„ì¹˜\n            originalY: position.y,\n            glowIntensity: 0\n        };\n        \n        // ê¸€ë¡œìš° ì´í™íŠ¸ ì¶”ê°€\n        const glowGeometry = itemType.geometry.clone();\n        const glowMaterial = new THREE.MeshBasicMaterial({\n            color: itemType.effectColor,\n            transparent: true,\n            opacity: 0.3\n        });\n        const glow = new THREE.Mesh(glowGeometry, glowMaterial);\n        glow.scale.setScalar(1.2);\n        item.add(glow);\n        item.userData.glow = glow;\n        \n        // í¬ì¸íŠ¸ ë¼ì´íŠ¸ ì¶”ê°€\n        const light = new THREE.PointLight(itemType.effectColor, 0.5, 3);\n        light.position.set(0, 0, 0);\n        item.add(light);\n        item.userData.light = light;\n        \n        this.scene.add(item);\n        \n        // íƒ€ì…ë³„ ë°°ì—´ì— ì¶”ê°€\n        switch (type) {\n            case 'COIN':\n                this.coins.push(item);\n                break;\n            case 'POWER_CUBE':\n                this.powerCubes.push(item);\n                break;\n            default:\n                this.specialItems.push(item);\n                break;\n        }\n        \n        return item;\n    }\n    \n    /**\n     * ë©”ì¸ ì—…ë°ì´íŠ¸\n     */\n    update(deltaTime) {\n        this.updateItemAnimations(deltaTime);\n        this.updateDynamicSpawning(deltaTime);\n        this.checkItemCollection();\n        this.updateParticles(deltaTime);\n    }\n    \n    /**\n     * ì•„ì´í…œ ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸\n     */\n    updateItemAnimations(deltaTime) {\n        const allItems = [...this.coins, ...this.powerCubes, ...this.specialItems];\n        \n        allItems.forEach(item => {\n            if (item.userData.collected) return;\n            \n            const type = item.userData.type;\n            const itemType = this.itemTypes[type];\n            \n            // ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸\n            item.userData.animationTimer += deltaTime;\n            \n            // íšŒì „ ì• ë‹ˆë©”ì´ì…˜\n            item.rotation.y += itemType.rotationSpeed * deltaTime;\n            \n            // ìƒí•˜ ë¶€ìœ  ì• ë‹ˆë©”ì´ì…˜\n            const bobOffset = Math.sin(item.userData.animationTimer * itemType.bobSpeed) * itemType.bobHeight;\n            item.position.y = item.userData.originalY + bobOffset;\n            \n            // ê¸€ë¡œìš° íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜\n            if (item.userData.glow) {\n                const glowPulse = Math.sin(item.userData.animationTimer * 4) * 0.2 + 0.8;\n                item.userData.glow.material.opacity = glowPulse * 0.3;\n                item.userData.glow.scale.setScalar(1.2 + glowPulse * 0.1);\n            }\n            \n            // ë¼ì´íŠ¸ ê°•ë„ ë³€í™”\n            if (item.userData.light) {\n                const lightPulse = Math.sin(item.userData.animationTimer * 3) * 0.3 + 0.7;\n                item.userData.light.intensity = lightPulse * 0.5;\n            }\n        });\n    }\n    \n    /**\n     * ë™ì  ìŠ¤í° ì‹œìŠ¤í…œ\n     */\n    updateDynamicSpawning(deltaTime) {\n        if (!this.dynamicSpawn.enabled) return;\n        \n        // ì½”ì¸ ìŠ¤í°\n        this.dynamicSpawn.coinSpawnTimer += deltaTime;\n        if (this.dynamicSpawn.coinSpawnTimer >= this.dynamicSpawn.coinSpawnInterval) {\n            this.dynamicSpawn.coinSpawnTimer = 0;\n            if (this.coins.length < this.spawnSettings.maxItems.coins) {\n                this.spawnRandomItem('COIN');\n            }\n        }\n        \n        // íë¸Œ ìŠ¤í°\n        this.dynamicSpawn.cubeSpawnTimer += deltaTime;\n        if (this.dynamicSpawn.cubeSpawnTimer >= this.dynamicSpawn.cubeSpawnInterval) {\n            this.dynamicSpawn.cubeSpawnTimer = 0;\n            if (this.powerCubes.length < this.spawnSettings.maxItems.powerCubes) {\n                this.spawnRandomItem('POWER_CUBE');\n            }\n        }\n        \n        // íŠ¹ìˆ˜ ì•„ì´í…œ ìŠ¤í°\n        this.dynamicSpawn.specialSpawnTimer += deltaTime;\n        if (this.dynamicSpawn.specialSpawnTimer >= this.dynamicSpawn.specialSpawnInterval) {\n            this.dynamicSpawn.specialSpawnTimer = 0;\n            if (this.specialItems.length < this.spawnSettings.maxItems.specialItems) {\n                const specialTypes = ['HEALTH_PACK', 'SPEED_BOOST', 'SHIELD'];\n                const randomType = specialTypes[Math.floor(Math.random() * specialTypes.length)];\n                this.spawnRandomItem(randomType);\n            }\n        }\n    }\n    \n    /**\n     * ëœë¤ ìœ„ì¹˜ì— ì•„ì´í…œ ìŠ¤í°\n     */\n    spawnRandomItem(type) {\n        const attempts = 10;\n        \n        for (let i = 0; i < attempts; i++) {\n            const x = 1 + Math.random() * 13;\n            const z = 1 + Math.random() * 13;\n            const position = new THREE.Vector3(x, 0.5, z);\n            \n            // í”Œë ˆì´ì–´ ê·¼ì²˜ê°€ ì•„ë‹ˆê³ , ë²½ì´ ì•„ë‹Œ ìœ„ì¹˜ ì°¾ê¸°\n            if (this.isValidSpawnPosition(position)) {\n                this.createItem(type, position);\n                break;\n            }\n        }\n    }\n    \n    /**\n     * ìœ íš¨í•œ ìŠ¤í° ìœ„ì¹˜ ì²´í¬\n     */\n    isValidSpawnPosition(position) {\n        // í”Œë ˆì´ì–´ì™€ ë„ˆë¬´ ê°€ê¹ì§€ ì•Šì€ì§€ ì²´í¬\n        if (this.gameManager.playerController) {\n            const playerPos = this.gameManager.playerController.position;\n            if (position.distanceTo(playerPos) < 3) {\n                return false;\n            }\n        }\n        \n        // ë²½ ìœ„ì¹˜ê°€ ì•„ë‹Œì§€ ì²´í¬ (ê°„ë‹¨í•œ êµ¬í˜„)\n        if (this.gameManager.maze && this.gameManager.maze.isWall) {\n            return !this.gameManager.maze.isWall(Math.round(position.x), Math.round(position.z));\n        }\n        \n        return true;\n    }\n    \n    /**\n     * ì•„ì´í…œ ìˆ˜ì§‘ ì²´í¬\n     */\n    checkItemCollection() {\n        if (!this.gameManager.playerController) return;\n        \n        const playerPos = this.gameManager.playerController.position;\n        const collectRange = 0.8;\n        \n        const allItems = [...this.coins, ...this.powerCubes, ...this.specialItems];\n        \n        allItems.forEach(item => {\n            if (item.userData.collected) return;\n            \n            const distance = playerPos.distanceTo(item.position);\n            if (distance < collectRange) {\n                this.collectItem(item);\n            }\n        });\n    }\n    \n    /**\n     * ì•„ì´í…œ ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    collectItem(item) {\n        if (item.userData.collected) return;\n        \n        item.userData.collected = true;\n        const type = item.userData.type;\n        const value = item.userData.value;\n        \n        // íƒ€ì…ë³„ ì²˜ë¦¬\n        switch (type) {\n            case 'COIN':\n                this.handleCoinCollection(value);\n                break;\n            case 'POWER_CUBE':\n                this.handlePowerCubeCollection(value);\n                break;\n            case 'HEALTH_PACK':\n                this.handleHealthPackCollection(value);\n                break;\n            case 'SPEED_BOOST':\n                this.handleSpeedBoostCollection();\n                break;\n            case 'SHIELD':\n                this.handleShieldCollection();\n                break;\n        }\n        \n        // ìˆ˜ì§‘ ì´í™íŠ¸\n        this.createCollectionEffect(item);\n        \n        // ì‚¬ìš´ë“œ ì¬ìƒ\n        this.playSound(this.itemTypes[type].collectSound);\n        \n        // UI ì•Œë¦¼\n        if (this.gameManager.uiManager) {\n            this.gameManager.uiManager.showPickupNotification(type, value);\n        }\n        \n        // ì•„ì´í…œ ì œê±°\n        this.removeItem(item);\n    }\n    \n    /**\n     * ì½”ì¸ ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    handleCoinCollection(value) {\n        if (this.gameManager.uiManager) {\n            this.gameManager.uiManager.addCoins(1);\n            this.gameManager.uiManager.addScore(value);\n        }\n        console.log(`ğŸª™ ì½”ì¸ íšë“! +${value}ì `);\n    }\n    \n    /**\n     * ì „ê¸° íë¸Œ ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    handlePowerCubeCollection(value) {\n        // ì „ê¸° ì´ ì—…ê·¸ë ˆì´ë“œ\n        if (this.gameManager.electroGun) {\n            const upgraded = this.gameManager.electroGun.upgrade(value);\n            if (upgraded) {\n                console.log('âš¡ ì „ê¸° ì´ ë ˆë²¨ ì—…!');\n            }\n        }\n        \n        // ì ìˆ˜ë„ ì¶”ê°€\n        if (this.gameManager.uiManager) {\n            this.gameManager.uiManager.addScore(value);\n        }\n        \n        console.log(`âš¡ ì „ê¸° íë¸Œ íšë“! ì „ë ¥ +${value}`);\n    }\n    \n    /**\n     * ì²´ë ¥íŒ© ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    handleHealthPackCollection(value) {\n        if (this.gameManager.playerController) {\n            this.gameManager.playerController.heal(value);\n        }\n        console.log(`â¤ï¸ ì²´ë ¥ íšŒë³µ! +${value}HP`);\n    }\n    \n    /**\n     * ìŠ¤í”¼ë“œ ë¶€ìŠ¤íŠ¸ ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    handleSpeedBoostCollection() {\n        if (this.gameManager.playerController) {\n            // ì¼ì‹œì ìœ¼ë¡œ ì´ë™ ì†ë„ ì¦ê°€\n            const originalSpeed = this.gameManager.playerController.moveSpeed;\n            this.gameManager.playerController.moveSpeed *= 1.5;\n            \n            setTimeout(() => {\n                if (this.gameManager.playerController) {\n                    this.gameManager.playerController.moveSpeed = originalSpeed;\n                }\n            }, this.itemTypes.SPEED_BOOST.duration * 1000);\n        }\n        console.log('ğŸƒ ìŠ¤í”¼ë“œ ë¶€ìŠ¤íŠ¸ í™œì„±í™”!');\n    }\n    \n    /**\n     * ì‹¤ë“œ ìˆ˜ì§‘ ì²˜ë¦¬\n     */\n    handleShieldCollection() {\n        if (this.gameManager.playerController) {\n            // ì¼ì‹œì  ë¬´ì  ìƒíƒœ\n            this.gameManager.playerController.invulnerable = true;\n            this.gameManager.playerController.invulnerabilityTime = this.itemTypes.SHIELD.duration * 1000;\n            \n            // ì‹œê°ì  íš¨ê³¼ (í”Œë ˆì´ì–´ ì£¼ë³€ì— ì‹¤ë“œ ì´í™íŠ¸)\n            this.createShieldEffect();\n        }\n        console.log('ğŸ›¡ï¸ ì‹¤ë“œ í™œì„±í™”!');\n    }\n    \n    /**\n     * ìˆ˜ì§‘ ì´í™íŠ¸ ìƒì„±\n     */\n    createCollectionEffect(item) {\n        const position = item.position.clone();\n        const color = this.itemTypes[item.userData.type].effectColor;\n        \n        // íŒŒí‹°í´ ìƒì„±\n        for (let i = 0; i < 15; i++) {\n            this.createParticle(\n                position, \n                color, \n                new THREE.Vector3(\n                    (Math.random() - 0.5) * 5,\n                    Math.random() * 3 + 2,\n                    (Math.random() - 0.5) * 5\n                ),\n                1.0 // ìƒëª…\n            );\n        }\n        \n        // ë§ í™•ì‚° ì´í™íŠ¸\n        this.createRingEffect(position, color);\n    }\n    \n    /**\n     * íŒŒí‹°í´ ìƒì„±\n     */\n    createParticle(position, color, velocity, life) {\n        const particleGeometry = new THREE.SphereGeometry(0.02, 4, 4);\n        const particleMaterial = new THREE.MeshBasicMaterial({ \n            color: color,\n            transparent: true,\n            opacity: 1\n        });\n        \n        const particle = new THREE.Mesh(particleGeometry, particleMaterial);\n        particle.position.copy(position);\n        \n        particle.userData = {\n            velocity: velocity,\n            life: life,\n            maxLife: life,\n            gravity: -5\n        };\n        \n        this.particleSystem.particles.push(particle);\n        this.scene.add(particle);\n    }\n    \n    /**\n     * ë§ í™•ì‚° ì´í™íŠ¸\n     */\n    createRingEffect(position, color) {\n        const ringGeometry = new THREE.RingGeometry(0.1, 0.2, 16);\n        const ringMaterial = new THREE.MeshBasicMaterial({ \n            color: color,\n            transparent: true,\n            opacity: 0.8,\n            side: THREE.DoubleSide\n        });\n        \n        const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n        ring.position.copy(position);\n        ring.rotation.x = -Math.PI / 2;\n        \n        this.scene.add(ring);\n        \n        // ì• ë‹ˆë©”ì´ì…˜\n        const startTime = performance.now();\n        const duration = 500; // 0.5ì´ˆ\n        \n        const animateRing = () => {\n            const elapsed = performance.now() - startTime;\n            const progress = elapsed / duration;\n            \n            if (progress < 1) {\n                ring.scale.setScalar(1 + progress * 3);\n                ring.material.opacity = 0.8 * (1 - progress);\n                requestAnimationFrame(animateRing);\n            } else {\n                this.scene.remove(ring);\n            }\n        };\n        \n        animateRing();\n    }\n    \n    /**\n     * ì‹¤ë“œ ì´í™íŠ¸ ìƒì„±\n     */\n    createShieldEffect() {\n        if (!this.gameManager.playerController) return;\n        \n        const shieldGeometry = new THREE.SphereGeometry(1.2, 16, 12);\n        const shieldMaterial = new THREE.MeshBasicMaterial({\n            color: 0x4169E1,\n            transparent: true,\n            opacity: 0.3,\n            wireframe: true\n        });\n        \n        const shield = new THREE.Mesh(shieldGeometry, shieldMaterial);\n        this.gameManager.playerController.camera.add(shield);\n        \n        // 15ì´ˆ í›„ ì œê±°\n        setTimeout(() => {\n            if (shield.parent) {\n                shield.parent.remove(shield);\n            }\n        }, this.itemTypes.SHIELD.duration * 1000);\n    }\n    \n    /**\n     * íŒŒí‹°í´ ì—…ë°ì´íŠ¸\n     */\n    updateParticles(deltaTime) {\n        for (let i = this.particleSystem.particles.length - 1; i >= 0; i--) {\n            const particle = this.particleSystem.particles[i];\n            const data = particle.userData;\n            \n            // ë¬¼ë¦¬ ì—…ë°ì´íŠ¸\n            data.velocity.y += data.gravity * deltaTime;\n            particle.position.add(data.velocity.clone().multiplyScalar(deltaTime));\n            \n            // ìƒëª… ê°ì†Œ\n            data.life -= deltaTime;\n            const lifeRatio = data.life / data.maxLife;\n            \n            // íˆ¬ëª…ë„ ê°ì†Œ\n            particle.material.opacity = lifeRatio;\n            \n            // ìƒëª… ëë‚˜ë©´ ì œê±°\n            if (data.life <= 0) {\n                this.scene.remove(particle);\n                this.particleSystem.particles.splice(i, 1);\n            }\n        }\n    }\n    \n    /**\n     * ì•„ì´í…œ ì œê±°\n     */\n    removeItem(item) {\n        const type = item.userData.type;\n        \n        // ë°°ì—´ì—ì„œ ì œê±°\n        switch (type) {\n            case 'COIN':\n                const coinIndex = this.coins.indexOf(item);\n                if (coinIndex > -1) this.coins.splice(coinIndex, 1);\n                break;\n            case 'POWER_CUBE':\n                const cubeIndex = this.powerCubes.indexOf(item);\n                if (cubeIndex > -1) this.powerCubes.splice(cubeIndex, 1);\n                break;\n            default:\n                const specialIndex = this.specialItems.indexOf(item);\n                if (specialIndex > -1) this.specialItems.splice(specialIndex, 1);\n                break;\n        }\n        \n        // ì”¬ì—ì„œ ì œê±°\n        this.scene.remove(item);\n    }\n    \n    /**\n     * ì‚¬ìš´ë“œ ì¬ìƒ\n     */\n    playSound(soundName) {\n        console.log(`ğŸ”Š ${soundName} ì‚¬ìš´ë“œ ì¬ìƒ`);\n        \n        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì›¹ ì˜¤ë””ì˜¤ API ì‚¬ìš©\n        // const audio = new Audio(`sounds/${soundName}.mp3`);\n        // audio.play();\n    }\n    \n    /**\n     * ëª¨ë“  ì•„ì´í…œ ì œê±° (ê²Œì„ ë¦¬ì…‹)\n     */\n    clearAllItems() {\n        [...this.coins, ...this.powerCubes, ...this.specialItems].forEach(item => {\n            this.scene.remove(item);\n        });\n        \n        this.coins = [];\n        this.powerCubes = [];\n        this.specialItems = [];\n        \n        // íŒŒí‹°í´ë„ ëª¨ë‘ ì œê±°\n        this.particleSystem.particles.forEach(particle => {\n            this.scene.remove(particle);\n        });\n        this.particleSystem.particles = [];\n    }\n    \n    /**\n     * ê²Œì„ ë¦¬ì…‹\n     */\n    reset() {\n        this.clearAllItems();\n        this.setupInitialItems();\n        \n        // ìŠ¤í° íƒ€ì´ë¨¸ ë¦¬ì…‹\n        this.dynamicSpawn.coinSpawnTimer = 0;\n        this.dynamicSpawn.cubeSpawnTimer = 0;\n        this.dynamicSpawn.specialSpawnTimer = 0;\n    }\n    \n    /**\n     * í˜„ì¬ ìƒíƒœ ë°˜í™˜\n     */\n    getState() {\n        return {\n            coinCount: this.coins.length,\n            powerCubeCount: this.powerCubes.length,\n            specialItemCount: this.specialItems.length,\n            totalItems: this.coins.length + this.powerCubes.length + this.specialItems.length,\n            particleCount: this.particleSystem.particles.length\n        };\n    }\n}