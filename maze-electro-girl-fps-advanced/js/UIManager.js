/**
 * UIManager: ê³ ê¸‰ UI ê´€ë¦¬ ì‹œìŠ¤í…œ
 * 
 * í•µì‹¬ ê¸°ëŠ¥:
 * - ì‹¤ì‹œê°„ HUD ì—…ë°ì´íŠ¸
 * - ê²Œì„ ìƒíƒœ í™”ë©´ ê´€ë¦¬
 * - ì• ë‹ˆë©”ì´ì…˜ ë° ì‹œê°ì  í”¼ë“œë°±
 * - ì•Œë¦¼ ë° íš¨ê³¼ ì‹œìŠ¤í…œ
 * - ë°˜ì‘í˜• UI ë””ìì¸
 */
class UIManager {
    constructor(gameManager) {
        this.gameManager = gameManager;
        
        // UI ìš”ì†Œë“¤
        this.elements = {\n            // HUD ìš”ì†Œë“¤\n            coinCount: document.getElementById('coinCount'),\n            score: document.getElementById('score'),\n            healthFill: document.getElementById('healthFill'),\n            healthText: document.getElementById('healthText'),\n            powerFill: document.getElementById('powerFill'),\n            powerLevel: document.getElementById('powerLevel'),\n            ammoCount: document.getElementById('ammoCount'),\n            \n            // í™”ë©´ ìš”ì†Œë“¤\n            mainMenu: document.getElementById('mainMenu'),\n            gameOverScreen: document.getElementById('gameOverScreen'),\n            victoryScreen: document.getElementById('victoryScreen'),\n            \n            // ì•Œë¦¼ ë° íš¨ê³¼\n            damageIndicator: document.getElementById('damageIndicator'),\n            pickupNotification: document.getElementById('pickupNotification'),\n            \n            // ìµœì¢… ê²°ê³¼\n            finalCoins: document.getElementById('finalCoins'),\n            finalScore: document.getElementById('finalScore'),\n            enemiesKilled: document.getElementById('enemiesKilled'),\n            victoryCoins: document.getElementById('victoryCoins'),\n            victoryScore: document.getElementById('victoryScore'),\n            completionTime: document.getElementById('completionTime')\n        };\n        \n        // ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ\n        this.animations = {\n            damageIndicator: {\n                active: false,\n                duration: 500,\n                startTime: 0\n            },\n            pickupNotification: {\n                active: false,\n                duration: 2000,\n                queue: []\n            },\n            scoreCounter: {\n                current: 0,\n                target: 0,\n                speed: 50 // ì´ˆë‹¹ ì¦ê°€ëŸ‰\n            },\n            coinCounter: {\n                current: 0,\n                target: 0,\n                speed: 5\n            }\n        };\n        \n        // ê²Œì„ í†µê³„\n        this.gameStats = {\n            startTime: 0,\n            endTime: 0,\n            coinsCollected: 0,\n            enemiesKilled: 0,\n            totalScore: 0\n        };\n        \n        // ì•Œë¦¼ ë©”ì‹œì§€ í…œí”Œë¦¿\n        this.notificationMessages = {\n            COIN: 'ğŸª™ ì½”ì¸ íšë“!',\n            POWER_CUBE: 'âš¡ ì „ê¸° íë¸Œ!',\n            HEALTH_PACK: 'â¤ï¸ ì²´ë ¥ íšŒë³µ!',\n            SPEED_BOOST: 'ğŸƒ ìŠ¤í”¼ë“œ ë¶€ìŠ¤íŠ¸!',\n            SHIELD: 'ğŸ›¡ï¸ ì‹¤ë“œ í™œì„±í™”!',\n            LEVEL_UP: 'ğŸ”¥ ì „ê¸° ì´ ë ˆë²¨ ì—…!',\n            ENEMY_KILL: 'ğŸ’€ ì  ì œê±°!'\n        };\n        \n        // í¬ë¡œìŠ¤í—¤ì–´ ìƒíƒœ\n        this.crosshair = {\n            element: document.querySelector('.crosshair'),\n            hitMarkerActive: false\n        };\n        \n        this.init();\n    }\n    \n    init() {\n        this.setupEventListeners();\n        this.initializeUI();\n    }\n    \n    /**\n     * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •\n     */\n    setupEventListeners() {\n        // ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ë“¤\n        document.getElementById('startBtn')?.addEventListener('click', () => {\n            this.startGame();\n        });\n        \n        document.getElementById('tutorialBtn')?.addEventListener('click', () => {\n            this.showTutorial();\n        });\n        \n        // ê²Œì„ ì˜¤ë²„ í™”ë©´ ë²„íŠ¼ë“¤\n        document.getElementById('restartBtn')?.addEventListener('click', () => {\n            this.restartGame();\n        });\n        \n        document.getElementById('mainMenuBtn')?.addEventListener('click', () => {\n            this.showMainMenu();\n        });\n        \n        // ìŠ¹ë¦¬ í™”ë©´ ë²„íŠ¼ë“¤\n        document.getElementById('playAgainBtn')?.addEventListener('click', () => {\n            this.restartGame();\n        });\n        \n        document.getElementById('victoryMenuBtn')?.addEventListener('click', () => {\n            this.showMainMenu();\n        });\n        \n        // ESC í‚¤ë¡œ ë©”ë‰´ í† ê¸€\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                this.toggleMenu();\n            }\n        });\n    }\n    \n    /**\n     * UI ì´ˆê¸°í™”\n     */\n    initializeUI() {\n        this.updateScore(0);\n        this.updateCoins(0);\n        this.updateHealth(100, 100);\n        this.updateWeaponLevel(1, 5);\n        this.showMainMenu();\n    }\n    \n    /**\n     * ë©”ì¸ ì—…ë°ì´íŠ¸ (ê²Œì„ ë£¨í”„ì—ì„œ í˜¸ì¶œ)\n     */\n    update(deltaTime) {\n        this.updateAnimations(deltaTime);\n        this.updateCounters(deltaTime);\n        this.updateEffects(deltaTime);\n    }\n    \n    /**\n     * ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸\n     */\n    updateAnimations(deltaTime) {\n        // ë°ë¯¸ì§€ ì¸ë””ì¼€ì´í„°\n        if (this.animations.damageIndicator.active) {\n            const elapsed = performance.now() - this.animations.damageIndicator.startTime;\n            const progress = elapsed / this.animations.damageIndicator.duration;\n            \n            if (progress >= 1) {\n                this.animations.damageIndicator.active = false;\n                this.elements.damageIndicator.classList.remove('active');\n            }\n        }\n        \n        // í”½ì—… ì•Œë¦¼\n        if (this.animations.pickupNotification.active) {\n            const elapsed = performance.now() - this.animations.pickupNotification.startTime;\n            const progress = elapsed / this.animations.pickupNotification.duration;\n            \n            if (progress >= 1) {\n                this.hidePickupNotification();\n                this.processNotificationQueue();\n            }\n        }\n    }\n    \n    /**\n     * ì¹´ìš´í„° ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸\n     */\n    updateCounters(deltaTime) {\n        // ì ìˆ˜ ì¹´ìš´í„°\n        if (this.animations.scoreCounter.current !== this.animations.scoreCounter.target) {\n            const diff = this.animations.scoreCounter.target - this.animations.scoreCounter.current;\n            const increment = Math.sign(diff) * Math.min(Math.abs(diff), this.animations.scoreCounter.speed * deltaTime);\n            this.animations.scoreCounter.current += increment;\n            \n            if (this.elements.score) {\n                this.elements.score.textContent = Math.floor(this.animations.scoreCounter.current);\n            }\n        }\n        \n        // ì½”ì¸ ì¹´ìš´í„°\n        if (this.animations.coinCounter.current !== this.animations.coinCounter.target) {\n            const diff = this.animations.coinCounter.target - this.animations.coinCounter.current;\n            const increment = Math.sign(diff) * Math.min(Math.abs(diff), this.animations.coinCounter.speed * deltaTime);\n            this.animations.coinCounter.current += increment;\n            \n            if (this.elements.coinCount) {\n                this.elements.coinCount.textContent = Math.floor(this.animations.coinCounter.current);\n            }\n        }\n    }\n    \n    /**\n     * íš¨ê³¼ ì—…ë°ì´íŠ¸\n     */\n    updateEffects(deltaTime) {\n        // í¬ë¡œìŠ¤í—¤ì–´ íˆíŠ¸ ë§ˆì»¤\n        if (this.crosshair.hitMarkerActive) {\n            // íˆíŠ¸ ë§ˆì»¤ëŠ” ì§§ì€ ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§\n            setTimeout(() => {\n                this.crosshair.hitMarkerActive = false;\n                this.crosshair.element?.classList.remove('hit');\n            }, 100);\n        }\n    }\n    \n    /**\n     * ì ìˆ˜ ì—…ë°ì´íŠ¸\n     */\n    updateScore(score) {\n        this.animations.scoreCounter.target = score;\n        this.gameStats.totalScore = score;\n    }\n    \n    /**\n     * ì½”ì¸ ìˆ˜ ì—…ë°ì´íŠ¸\n     */\n    updateCoins(coins) {\n        this.animations.coinCounter.target = coins;\n        this.gameStats.coinsCollected = coins;\n    }\n    \n    /**\n     * ì²´ë ¥ ì—…ë°ì´íŠ¸\n     */\n    updateHealth(current, max) {\n        if (!this.elements.healthFill || !this.elements.healthText) return;\n        \n        const percentage = (current / max) * 100;\n        this.elements.healthFill.style.width = `${percentage}%`;\n        this.elements.healthText.textContent = Math.ceil(current);\n        \n        // ì²´ë ¥ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”\n        if (percentage > 70) {\n            this.elements.healthFill.style.background = 'linear-gradient(90deg, #00FF00, #66FF66)';\n        } else if (percentage > 30) {\n            this.elements.healthFill.style.background = 'linear-gradient(90deg, #FFFF00, #FFFF66)';\n        } else {\n            this.elements.healthFill.style.background = 'linear-gradient(90deg, #FF0000, #FF6B6B)';\n        }\n        \n        // ì²´ë ¥ì´ ë‚®ì„ ë•Œ ê¹œë¹¡ì„ íš¨ê³¼\n        if (percentage < 20) {\n            this.elements.healthFill.style.animation = 'healthCritical 1s infinite';\n        } else {\n            this.elements.healthFill.style.animation = 'none';\n        }\n    }\n    \n    /**\n     * ë¬´ê¸° ë ˆë²¨ ì—…ë°ì´íŠ¸\n     */\n    updateWeaponLevel(level, maxLevel) {\n        if (!this.elements.powerFill || !this.elements.powerLevel) return;\n        \n        const percentage = (level / maxLevel) * 100;\n        this.elements.powerFill.style.width = `${percentage}%`;\n        this.elements.powerLevel.textContent = level;\n        \n        // ë ˆë²¨ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”\n        const colors = [\n            'linear-gradient(90deg, #8A2BE2, #DDA0DD)', // ë ˆë²¨ 1\n            'linear-gradient(90deg, #00FFFF, #66FFFF)', // ë ˆë²¨ 2\n            'linear-gradient(90deg, #FFD700, #FFFF66)', // ë ˆë²¨ 3\n            'linear-gradient(90deg, #FF6B6B, #FF9999)', // ë ˆë²¨ 4\n            'linear-gradient(90deg, #00FF00, #66FF66)'  // ë ˆë²¨ 5\n        ];\n        \n        this.elements.powerFill.style.background = colors[level - 1] || colors[0];\n    }\n    \n    /**\n     * ì˜¤ë²„íˆíŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸\n     */\n    updateOverheat(heat, maxHeat, overheated) {\n        // ì˜¤ë²„íˆíŠ¸ UI êµ¬í˜„ (í•„ìš”ì‹œ ì¶”ê°€)\n        if (overheated) {\n            // í™”ë©´ì— ì˜¤ë²„íˆíŠ¸ ê²½ê³  í‘œì‹œ\n            console.log('ğŸ”¥ ë¬´ê¸° ê³¼ì—´!');\n        }\n    }\n    \n    /**\n     * ë°ë¯¸ì§€ ì¸ë””ì¼€ì´í„° í‘œì‹œ\n     */\n    showDamageIndicator() {\n        if (!this.elements.damageIndicator) return;\n        \n        this.animations.damageIndicator.active = true;\n        this.animations.damageIndicator.startTime = performance.now();\n        this.elements.damageIndicator.classList.add('active');\n        \n        // í¬ë¡œìŠ¤í—¤ì–´ë„ ë¹¨ê°›ê²Œ\n        this.crosshair.element?.classList.add('damage');\n        setTimeout(() => {\n            this.crosshair.element?.classList.remove('damage');\n        }, 300);\n    }\n    \n    /**\n     * í”½ì—… ì•Œë¦¼ í‘œì‹œ\n     */\n    showPickupNotification(type, value) {\n        const message = this.notificationMessages[type] || 'ì•„ì´í…œ íšë“!';\n        const displayText = value ? `${message} +${value}` : message;\n        \n        // íì— ì¶”ê°€\n        this.animations.pickupNotification.queue.push({\n            text: displayText,\n            type: type\n        });\n        \n        // í˜„ì¬ í‘œì‹œ ì¤‘ì´ ì•„ë‹ˆë©´ ì¦‰ì‹œ í‘œì‹œ\n        if (!this.animations.pickupNotification.active) {\n            this.processNotificationQueue();\n        }\n    }\n    \n    /**\n     * ì•Œë¦¼ í ì²˜ë¦¬\n     */\n    processNotificationQueue() {\n        if (this.animations.pickupNotification.queue.length === 0) {\n            return;\n        }\n        \n        const notification = this.animations.pickupNotification.queue.shift();\n        this.displayPickupNotification(notification);\n    }\n    \n    /**\n     * í”½ì—… ì•Œë¦¼ ì‹¤ì œ í‘œì‹œ\n     */\n    displayPickupNotification(notification) {\n        if (!this.elements.pickupNotification) return;\n        \n        this.elements.pickupNotification.textContent = notification.text;\n        this.elements.pickupNotification.className = `pickup-notification show ${notification.type.toLowerCase()}`;\n        \n        this.animations.pickupNotification.active = true;\n        this.animations.pickupNotification.startTime = performance.now();\n    }\n    \n    /**\n     * í”½ì—… ì•Œë¦¼ ìˆ¨ê¸°ê¸°\n     */\n    hidePickupNotification() {\n        if (!this.elements.pickupNotification) return;\n        \n        this.elements.pickupNotification.classList.remove('show');\n        this.animations.pickupNotification.active = false;\n    }\n    \n    /**\n     * íˆíŠ¸ ë§ˆì»¤ í‘œì‹œ\n     */\n    showHitMarker() {\n        if (!this.crosshair.element) return;\n        \n        this.crosshair.element.classList.add('hit');\n        this.crosshair.hitMarkerActive = true;\n    }\n    \n    /**\n     * ê²Œì„ ì‹œì‘\n     */\n    startGame() {\n        this.hideAllScreens();\n        this.gameStats.startTime = performance.now();\n        \n        if (this.gameManager) {\n            this.gameManager.startGame();\n        }\n    }\n    \n    /**\n     * ê²Œì„ ì¬ì‹œì‘\n     */\n    restartGame() {\n        this.hideAllScreens();\n        this.resetStats();\n        this.initializeUI();\n        \n        if (this.gameManager) {\n            this.gameManager.restartGame();\n        }\n    }\n    \n    /**\n     * ë©”ì¸ ë©”ë‰´ í‘œì‹œ\n     */\n    showMainMenu() {\n        this.hideAllScreens();\n        if (this.elements.mainMenu) {\n            this.elements.mainMenu.style.display = 'flex';\n        }\n        \n        // í¬ì¸í„° ë½ í•´ì œ\n        if (document.pointerLockElement) {\n            document.exitPointerLock();\n        }\n    }\n    \n    /**\n     * ê²Œì„ ì˜¤ë²„ í™”ë©´ í‘œì‹œ\n     */\n    showGameOver() {\n        this.hideAllScreens();\n        this.gameStats.endTime = performance.now();\n        \n        // ìµœì¢… í†µê³„ ì—…ë°ì´íŠ¸\n        if (this.elements.finalCoins) {\n            this.elements.finalCoins.textContent = this.gameStats.coinsCollected;\n        }\n        if (this.elements.finalScore) {\n            this.elements.finalScore.textContent = this.gameStats.totalScore;\n        }\n        if (this.elements.enemiesKilled) {\n            this.elements.enemiesKilled.textContent = this.gameStats.enemiesKilled;\n        }\n        \n        if (this.elements.gameOverScreen) {\n            this.elements.gameOverScreen.style.display = 'flex';\n        }\n        \n        // í¬ì¸í„° ë½ í•´ì œ\n        if (document.pointerLockElement) {\n            document.exitPointerLock();\n        }\n    }\n    \n    /**\n     * ìŠ¹ë¦¬ í™”ë©´ í‘œì‹œ\n     */\n    showVictory() {\n        this.hideAllScreens();\n        this.gameStats.endTime = performance.now();\n        \n        const completionTime = (this.gameStats.endTime - this.gameStats.startTime) / 1000;\n        const minutes = Math.floor(completionTime / 60);\n        const seconds = Math.floor(completionTime % 60);\n        \n        // ìŠ¹ë¦¬ í†µê³„ ì—…ë°ì´íŠ¸\n        if (this.elements.victoryCoins) {\n            this.elements.victoryCoins.textContent = this.gameStats.coinsCollected;\n        }\n        if (this.elements.victoryScore) {\n            this.elements.victoryScore.textContent = this.gameStats.totalScore;\n        }\n        if (this.elements.completionTime) {\n            this.elements.completionTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n        }\n        \n        if (this.elements.victoryScreen) {\n            this.elements.victoryScreen.style.display = 'flex';\n        }\n        \n        // í¬ì¸í„° ë½ í•´ì œ\n        if (document.pointerLockElement) {\n            document.exitPointerLock();\n        }\n    }\n    \n    /**\n     * íŠœí† ë¦¬ì–¼ í‘œì‹œ\n     */\n    showTutorial() {\n        alert(`ğŸ® ê²Œì„ íŠœí† ë¦¬ì–¼\n\nâš¡ ë¯¸ë¡œì˜ ì „ê¸° ì´ ì†Œë…€ê°€ ë˜ì–´ ëª¨í—˜ì„ ë– ë‚˜ë³´ì„¸ìš”!\n\nğŸ¯ ëª©í‘œ:\nâ€¢ ğŸª™ ì½”ì¸ì„ ìˆ˜ì§‘í•˜ì—¬ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”\nâ€¢ âš¡ ì „ê¸° íë¸Œë¡œ ì´ì„ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”\nâ€¢ ğŸ‘¹ ì•…ë‹¹ë“¤ì„ ë¬¼ë¦¬ì¹˜ì„¸ìš”\n\nğŸ® ì¡°ì‘ë²•:\nâ€¢ WASD / ë°©í–¥í‚¤: ì´ë™\nâ€¢ ë§ˆìš°ìŠ¤: ì‹œì  íšŒì „\nâ€¢ ìŠ¤í˜ì´ìŠ¤: ì í”„\nâ€¢ í´ë¦­: ì „ê¸° ì´ ë°œì‚¬\nâ€¢ ESC: ë©”ë‰´\n\nğŸ’¡ íŒ:\nâ€¢ ì í”„ë¡œ ë†’ì€ ê³³ì˜ ì•„ì´í…œì„ íšë“í•˜ì„¸ìš”\nâ€¢ ì „ê¸° íë¸Œë¡œ ì´ì„ ê°•í™”í•˜ë©´ ìƒˆë¡œìš´ ëŠ¥ë ¥ì´ í•´ê¸ˆë©ë‹ˆë‹¤\nâ€¢ ì ë“¤ë§ˆë‹¤ ë‹¤ë¥¸ í–‰ë™ íŒ¨í„´ì„ ê°€ì§€ê³  ìˆì–´ìš”`);\n    }\n    \n    /**\n     * ë©”ë‰´ í† ê¸€\n     */\n    toggleMenu() {\n        if (this.gameManager && this.gameManager.isPlaying()) {\n            this.showMainMenu();\n            this.gameManager.pauseGame();\n        }\n    }\n    \n    /**\n     * ëª¨ë“  í™”ë©´ ìˆ¨ê¸°ê¸°\n     */\n    hideAllScreens() {\n        const screens = [\n            this.elements.mainMenu,\n            this.elements.gameOverScreen,\n            this.elements.victoryScreen\n        ];\n        \n        screens.forEach(screen => {\n            if (screen) {\n                screen.style.display = 'none';\n            }\n        });\n    }\n    \n    /**\n     * í†µê³„ ë¦¬ì…‹\n     */\n    resetStats() {\n        this.gameStats = {\n            startTime: 0,\n            endTime: 0,\n            coinsCollected: 0,\n            enemiesKilled: 0,\n            totalScore: 0\n        };\n        \n        this.animations.scoreCounter.current = 0;\n        this.animations.scoreCounter.target = 0;\n        this.animations.coinCounter.current = 0;\n        this.animations.coinCounter.target = 0;\n    }\n    \n    /**\n     * ì  ì²˜ì¹˜ ê¸°ë¡\n     */\n    recordEnemyKill() {\n        this.gameStats.enemiesKilled++;\n        this.showPickupNotification('ENEMY_KILL', null);\n    }\n    \n    /**\n     * ë ˆë²¨ì—… ì•Œë¦¼\n     */\n    showLevelUpNotification() {\n        this.showPickupNotification('LEVEL_UP', null);\n    }\n    \n    /**\n     * UI ê°€ì‹œì„± ì„¤ì •\n     */\n    setUIVisibility(visible) {\n        const hud = document.querySelector('.hud');\n        const crosshair = document.querySelector('.crosshair');\n        \n        if (hud) hud.style.display = visible ? 'flex' : 'none';\n        if (crosshair) crosshair.style.display = visible ? 'block' : 'none';\n    }\n    \n    /**\n     * í˜„ì¬ ìƒíƒœ ë°˜í™˜\n     */\n    getState() {\n        return {\n            gameStats: { ...this.gameStats },\n            isMenuVisible: this.elements.mainMenu?.style.display !== 'none',\n            currentScore: this.animations.scoreCounter.current,\n            currentCoins: this.animations.coinCounter.current\n        };\n    }\n}\n\n// ì¶”ê°€ CSS ì• ë‹ˆë©”ì´ì…˜ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€\nconst uiStyles = document.createElement('style');\nuiStyles.textContent = `\n    .crosshair.hit {\n        color: #FF0000 !important;\n        transform: translate(-50%, -50%) scale(1.3);\n        transition: all 0.1s ease;\n    }\n    \n    .crosshair.damage {\n        color: #FF6666 !important;\n        filter: drop-shadow(0 0 5px #FF0000);\n    }\n    \n    .pickup-notification.coin {\n        border-color: #FFD700;\n        color: #FFD700;\n    }\n    \n    .pickup-notification.power_cube {\n        border-color: #00FFFF;\n        color: #00FFFF;\n    }\n    \n    .pickup-notification.health_pack {\n        border-color: #FF6B6B;\n        color: #FF6B6B;\n    }\n    \n    @keyframes healthCritical {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n    }\n    \n    .hud {\n        transition: all 0.3s ease;\n    }\n    \n    .hud.hidden {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n`;\ndocument.head.appendChild(uiStyles);